%% dyadics in spherical coordinates
clear all; clc
syms ri Ri R T Ph ph t p C1 C2  real
r = (R^3 + ri^3 - Ri^3)^(1/3); t = T; ph = Ph;
F = [R^2/r^2   0     0;...
           0         r/R     0; ...
           0            0           r/R];  
B = F*F.';
C = F.'*F;

StressMat = -p * eye(3) + C1*C + C2 * pinv(C);
sigma_rr = StressMat(1,1);
sigma_pp = StressMat(2,2);
sigma_tt = StressMat(3,3);

% confirm \sigma_{rr} + sigma_pp - 2 sigma_tt
integ_int = sigma_tt + sigma_pp - 2 * sigma_rr;
simplify(integ_int)

%% Deformation analysis
clc; clear all; close all
profile on -history
%{
sphere_path=fullfile(homedir, otherpath, 'sphere.STL');
% model = createpde(1);
model = createpde('structural', 'static-solid');
importGeometry(model, sphere_path);

% Plots
close all
figure(1)
subplot(211)
pdegplot(model,'FaceLabels','on')
view(30,30);
title('Frontal view')

subplot(212)
pdegplot(model,'FaceLabels','on')
view(30,30);
title('Rear view')

% specify material moduli, poison ratio for the deformation;
structuralProperties(model,'YoungsModulus',200e9,...
            'PoissonsRatio',.45,'MassDensity',.5/386);
% define the boundary conditions
structuralBC(model,'Face',1,'Constraint','symmetric'); % symmetric isochoric

%Specify the gravity load on the sphere.
structuralBodyLoad(model,'GravitationalAcceleration',[0;0;-9.8]);
%}
%% Multisphere; Concentric sphere with internal cavity
close all; clc; clear all
homedir = '/home/lex/';
savedir = 'Documents/Papers/PhDThesis/figures/deformation';

% Testing BVP for Contact free system
cd('/home/lex/Documents/MATLAB/screws');
start = tic;
[Ri, Ro] = deal(.5, .7);  % 50cm 70 cm

% material moduli for internal and external IAB skin
[C1, C2] = deal(11000, 22000);
% IAB material density
[rho, nu] = deal(.38/386., .48);  % cue from dynamics of recatangular block example
ri = .65; % meters
close all
[P, result] = bvp_free(C1, C2, Ri, Ro, rho, nu, ri)
fprintf('Time to run: %f seconds', toc(start))


%% Examine solution
minUz = min(result.Displacement.uz);
fprintf('Maximal deflection in the z-direction is %g meters.',minUz)

full_path=fullfile(homedir, savedir);
% Plot the displacements
figure(3)
g3 = pdeplot3D(model,'ColorMapData',result.Displacement.ux);
title('x-displacement')
% : R_i = 50cm, R_o = 70cm, r_i = R_i + 20 (cm)
colormap('jet')
saveas(g3, fullfile(full_path, 'xdisp-aber.png'))

figure(4)
pdeplot3D(model,'ColorMapData',result.Displacement.uy);
xlabel('Time')
title('y-displacement')
grid('on')
colormap('jet')
saveas(gcf, fullfile(full_path, 'ydisp.png'))

figure(5)
pdeplot3D(model,'ColorMapData',result.Displacement.uz);
title('z-displacement')
% : R_i = 50cm, R_o = 70cm, r_i = R_i + 20 (cm)
colormap('jet')
saveas(gcf, fullfile(full_path, 'zdisp.png'))

figure(6)
pdeplot3D(model,'ColorMapData',result.Displacement.Magnitude);
title('Overall Displacement')
% : R_i = 50cm, R_o = 70cm, r_i = R_i + 20 (cm)'
grid('on')
colormap('jet')
saveas(gcf, fullfile(full_path, 'alldisp.png'))
